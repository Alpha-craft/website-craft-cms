{% extends "_layouts/layout.twig" %}

{% block content %}
{% set searchQuery = craft.app.request.getQueryParam('search') %}

{% set rawCategory =[ 
  craft.app.request.queryParam('moisture') ?? '',
  craft.app.request.queryParam('soil-type') ?? '',
]
%}

{% set categories = null %}

{% if rawCategory is not empty %}
  {% set categories = craft.categories
    .slug(rawCategory)
    .one()
  %}
{% endif %}

{% set query = craft.entries()
  .section('plants')
  .relatedTo(categories)
  .search(searchQuery)
  .limit(3) 
%}

<div class="bg-gray-200 lg:h-screen">
  <div class="container mx-auto">
      {% paginate query as pageInfo, pageEntries %}
      <div class=" bg-blue-200 rounded py-28">
        <div class="md:flex md:space-x-12 md:space-y-0 space-y-5 place-content-center">
          {% if query|length or categories|length %}
            {% for entry in pageEntries %}
              {% embed "_includes/card-list.twig" %}
                {% block list %}
                  <a href="{{entry.url}}">
                    <div class="w-auto h-auto">
                      <div class="text-center md:text-left bg-blue-500 rounded-sm text-2xl px-2" > {{entry.title}} </div>
                      <img src="{{entry.image.one().url}}" alt="" style="height: 150px; width: 300px;" class="m-auto">
                    </div>
                  </a>
                {% endblock %}
              {% endembed  %}
            {% endfor %}            
          
        </div>
      </div>
        
        {% if searchQuery|length %}
          <p class="">jumlah yang ditemukan untuk hasil "{{searchQuery}}" : {{query|length}} </p> 
        {% endif %}
        {% else %}
          <div>
            <p>Maaf,Tidak Ditemukan hasil untuk "{{searchQuery}}"</p>
            <div class="bg-red-500 text-white hover:text-red-500 hover:bg-white cursor-pointer m-auto w-5/6 h-4/5 border-red-500 border-2 px-16 py-11 rounded-md" onclick="kembali()"> <p class="text-center">Go Back</p> </div>
          </div>
        {% endif %}

    <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 text-center md:space-x-6 my-10">
      {% if pageInfo.prevUrl %}<a href="{{ pageInfo.prevUrl }}" class="flex-1 bg-blue-500 rounded"><div>Previous Page</div></a> {% endif %}
      {% if pageInfo.nextUrl %}<a href="{{ pageInfo.nextUrl }}" class="flex-1 bg-blue-500 rounded"><div>Next Page</div></a>{% endif %} 
    </div>
  </div>
</div>

{% endblock  %}